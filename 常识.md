# 常识

## 术语

术语 | 解释
---|---
VA(virual Address) | 进程的虚拟地址
OP code(OPeration code) | CPU 指令(字节码 byte code)
PE(Portable Executable) | Windows 可执行文件(EXE、DLL、SYS 等)

## 分析方法

* 静态分析法：在不执行代码文件的情形下，对代码进行静态分析。
  * 常见特征
    * 文件类型
    * 文件大小
    * PE 头信息
    * Import/Export API
    * 内部字符串
    * 是否运行时解压缩
    * 注册信息
    * 调试信息
    * 数字证书
    * 内部代码、代码结构
* 动态分析法：在程序文件的执行过程中对代码进行动态分析。
  * 分析重点
    * 文件
    * 注册表
    * 网络
    * 内部结构
    * 动作原理

## OllyDbg

### 窗口

![窗口](attach/2022-08-18-21-17-18.png)

1. 代码窗口：默认显示反汇编代码，还可用于显示注释、标签，分析代码时显示循环、跳转位置等信息
2. 寄存器窗口：实时显示 CPU 寄存器的值，可用于修改特定的寄存器
3. 数据窗口：以 Hex/ASCII/Unicode 值的形式显示进程的内存地址，可在此修改内存地址
4. 栈窗口：实时显示 ESP 寄存器指向的进程栈内存，并允许修改

### 常用指令

指令 | 快捷键
------- | -------
重新开始调试 | Ctrl+F2
单步步入 | F7
单步步过 | F8
运行到返回 | Ctrl+F9
移动到指定地址 | Ctrl+G
执行到光标位置 | F4
添加注释 | ;
添加标签 | :
设置断点 | F2
运行 | F9
高亮当前 EIP 地址 | *
显示上一个光标未知 | -
查看 CALL/JMP 指令的相关地址 | Enter
编辑数据 | Ctrl+E
编写汇编代码 | 空格
创建修改副本 | 右键 -> 复制到可执行文件

### 快速跳转重要代码

1. Goto 命令：Ctrl+G 后输入地址，光标移动到地址处，输入 F4，程序运行到光标处
2. 设置断点：F2 设置断点， ALT+B 可以查看全部断点
3. 使用注释：; 添加注释，右键查找 -> 用户定义的注释进行选择、跳转
4. 使用标签：: 添加标签，右键查找 -> 用户定义的标签进行选择、跳转

### 快速查找指定代码

1. 代码执行：逐条执行指令查找需要代码的位置。适用于功能明确（如弹窗），代码量不大的程序。
2. 字符串检索：右键 -> 搜索 -> 所有参考文本字串，也可使用插件。
3. API 检索：右键 -> 查找 -> 所有模块间的调用
4. API 检索：右键 -> 查找 -> 所有模块中的名称
5. 若软件被加壳，则可以在导入的 DLL 处设置断点

### 打补丁

* 修改字符串
  1. 直接修改字符串缓冲区
     * 找到要修改的缓冲区地址，在数据窗口选中，Ctrl+E 修改
     * 当修改的长度大于原有的长度时，可能会损坏后面的数据
  2. 在其他内存区域生成新字符串并传递给消息函数
     * 其他区域需要可写，修改的位置需要对齐偏移

* 保存更改
  * 选中更改区域，右键 -> 复制到可执行文件(一次只复制一个窗口的修改) -> 右键 -> 保存文件
